
# Конфигурация CLI `pr`

## 1. Группа команд `config`

Эта группа команд предназначена для управления настройками самого CLI-инструмента `pr`. Она напрямую связана с тем, как программа инициализируется и как устанавливается её рабочее окружение.

*   **`pr config show`**
    *   **Описание:** Отображает текущие активные настройки CLI. Эти настройки берутся либо из файла конфигурации (если он существует и доступен), либо из значений по умолчанию.
    *   **Вывод:** Список пар ключ-значение, демонстрирующий все применимые настройки CLI. Например:
        ```
        CLI Configuration:
          default_language: python3
          interface_language: en
          preferred_editor: vim
          theme: default
          auto_save_drafts: true
          data_dir: ~/.config/practiceraptor/data
          editor_args: []
        ```
    *   **Контекст:** Эта команда полезна для того, чтобы пользователь мог увидеть, какие настройки используются, и понять, почему команда работает так, а не иначе.

*   **`pr config set <key> <value>`**
    *   **Описание:** Устанавливает новое значение для указанного параметра конфигурации CLI. Изменение применяется как к текущей сессии, так и сохраняется в файл конфигурации для будущих запусков.
    *   **Параметры:**
        *   `<key>`: Название параметра конфигурации (например, `default_language`, `preferred_editor`, `interface_language`, `theme`, `auto_save_drafts`). **(Обязательный параметр)**
        *   `<value>`: Новое значение для параметра. **(Обязательный параметр)**
    *   **Поведение:**
        1.  Обновляет значение в памяти приложения.
        2.  Перезаписывает файл конфигурации (например, `~/.practiceraptor.yaml`) с обновленными настройками.
        3.  **Важно:** Если изменен параметр, влияющий на контекст (например, `default_language`, `interface_language`, `preferred_editor`), приложение может инициировать частичное переформирование контекста, чтобы изменения вступили в силу немедленно для последующих команд в текущей сессии.
    *   **Примеры:**
        *   `pr config set default_language go`
        *   `pr config set preferred_editor code --editor-args "--wait"` (пример для передачи аргументов редактору)
        *   `pr config set interface_language ru`

*   **`pr config init`**
    *   **Описание:** Создает файл конфигурации CLI со значениями по умолчанию, если файл конфигурации отсутствует.
    *   **Поведение:**
        1.  Проверяет существование файла конфигурации (например, `~/.practiceraptor.yaml`).
        2.  Если файл не найден, создает его и записывает туда стандартный набор настроек по умолчанию.
        3.  Если файл уже существует, выводит сообщение о том, что файл конфигурации уже есть, и предлагает использовать `pr config set` для внесения изменений.
    *   **Полезность:** Позволяет пользователю быстро установить начальные настройки, если он запускает `pr` впервые.

## 2. Цепочка событий при запуске программы в режиме REPL

При запуске CLI `pr` происходит следующая последовательность действий для инициализации окружения:

1.  **Старт приложения и поиск конфигурации:**
    *   Пользователь вводит команду `pr` (или `practiceraptor`) в терминале.
    *   Приложение запускается.
    *   **Шаг 1: Инициализация конфигурации.**
        *   Программа ищет файл конфигурации CLI (по умолчанию `~/.practiceraptor.yaml`).
        *   **Сценарий А (Файл конфигурации существует):** Настройки (например, `default_language`, `preferred_editor`, `interface_language`, `theme`, `auto_save_drafts`) считываются из файла.
        *   **Сценарий Б (Файл конфигурации отсутствует):** Используются предопределённые значения по умолчанию. В этом случае может быть автоматически вызван `pr config init` для создания файла.
        *   Все настройки сохраняются в оперативной памяти приложения.

2.  **Формирование рабочего контекста:**
    *   **Шаг 2: Установка контекста.**
        *   На основе загруженной конфигурации (Шаг 1) и текущего состояния системы, устанавливается операционный контекст:
            *   **Конфигурация CLI:** Загруженные/дефолтные настройки.
            *   **Пользовательский профиль:** Загрузка настроек пользователя (предпочитаемый язык для задач, прогресс, история) из файла (например, `~/.config/practiceraptor/user.yaml`). При отсутствии используется дефолтный профиль (например, `interface_language='en'`, анонимный пользователь).
            *   **Текущая задача:** Определение активной задачи или несохраненного draft'а.
            *   **Текущий язык:** Установка языка для описания задач и языка кода по умолчанию (`interface_language` + `default_language`).
            *   **Рабочая директория:** Определение директории запуска.

3.  **Вход в режим REPL:**
    *   **Шаг 3: Запуск REPL.**
        *   После успешной инициализации, приложение переходит в режим REPL.
        *   Отображается приглашение командной строки (например, `pr>`).
        *   Приложение ожидает ввода команды.

4.  **Обработка команд пользователя:**
    *   **Шаг 4: Выполнение команды.**
        *   Пользователь вводит команду (например, `pr task list`).
        *   CLI парсит команду.
        *   Выполняется логика команды, используя установленный контекст и конфигурацию.
        *   Результат отображается пользователю.
        *   Приглашение `pr>` снова отображается.

---

## Структура CLI (обзор)

### Основные группы команд:

1.  **`task`**: Управление задачами (просмотр, фильтрация, выбор).
2.  **`solve`**: Процесс решения задач (написание, проверка, подсказки).
3.  **`user`**: Управление профилем пользователя и статистикой.
4.  **`config`**: Управление настройками самого CLI.

---

## Предлагаемая структура команд

### 1. Группа команд `task`

*   **`pr task list`**
    *   **Описание:** Показать список доступных задач.
    *   **Параметры/опции:** `--difficulty <level>`, `--tag <tag>`, `--status <status>`, `--search <query>`, `--page <number>`, `--per-page <number>`.
    *   **Дефолты:** `difficulty='all'`, `tag='all'`, `status='all'`, `page=1`, `per-page=20`.
*   **`pr task view <task_id_or_slug>`**
    *   **Описание:** Показать полное описание конкретной задачи.
    *   **Параметры:** `<task_id_or_slug>` (обязательный).
    *   **Опции:** `--lang <language>`, `--language <locale>`.
    *   **Дефолты:** `lang='python3'`, `language='en'`.
*   **`pr task random`**
    *   **Описание:** Выбрать и показать случайную задачу.
    *   **Параметры/опции:** Аналогичны `pr task list` для фильтрации (`--difficulty`, `--tag`, `--status`).

### 2. Группа команд `solve`

*   **`pr solve <task_id_or_slug>`**
    *   **Описание:** Начать решение задачи.
    *   **Параметры:** `<task_id_or_slug>` (обязательный).
    *   **Опции:** `--lang <language>`, `--editor <editor_command>`, `--interactive`.
    *   **Дефолты:** `lang` из конфига пользователя, `editor` из конфига CLI, `interactive=False`.
*   **`pr solve check`**
    *   **Описание:** Проверить текущий код.
    *   **Опции:** `--fast`, `--lang <language>`.
    *   **Дефолты:** `fast=False`, `lang` текущего draft'а.
*   **`pr solve hint`**
    *   **Описание:** Получить подсказку.
    *   **Опции:** `--level <number>`.
    *   **Дефолты:** `level=1`.
*   **`pr solve solution`**
    *   **Описание:** Посмотреть эталонное/пользовательское решение.
    *   **Опции:** `--lang <language>`, `--community`.
    *   **Дефолты:** `lang='python3'`, `community=False`.
*   **`pr solve submit`**
    *   **Описание:** Отправить решение.
    *   **Опции:** `--lang <language>`.
    *   **Дефолты:** `lang` текущего draft'а.

### 3. Группа команд `user`

*   **`pr user settings view`**
    *   **Описание:** Показать текущие настройки пользователя.
*   **`pr user settings set <key> <value>`**
    *   **Описание:** Установить настройку пользователя.
    *   **Примеры:** `pr user settings set default_language go`, `pr user settings set interface_language ru`.
*   **`pr user progress`**
    *   **Описание:** Отобразить сводку прогресса.
    *   **Опции:** `--detail <level>`.
    *   **Дефолты:** `detail='summary'`.
*   **`pr user history`**
    *   **Описание:** Показать историю решений.
    *   **Опции:** `--task <task_id_or_slug>`, `--lang <language>`.

### 4. Группа команд `config`

*   **`pr config show`**
    *   **Описание:** Показать текущую конфигурацию CLI.
*   **`pr config set <key> <value>`**
    *   **Описание:** Установить настройку CLI.
*   **`pr config init`**
    *   **Описание:** Инициализировать файл конфигурации CLI со значениями по умолчанию.

---

**Дополнительные соображения:**

*   **Цветовой вывод:** Должен быть консистентным и соответствовать принципам UX.
*   **Конфигурационный файл:** Основные настройки CLI хранятся в `~/.practiceraptor.yaml`.
*   **Автосохранение (Drafts):** Код автоматически сохраняется при переключении задач или выходе.
*   **Консистентность:** Все команды должны предоставлять ясную и унифицированную обратную связь.
